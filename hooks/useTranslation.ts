import React, { createContext, useState, useContext, ReactNode, useCallback } from 'react';
import i18next from 'i18next';
import { initReactI18next, useTranslation as useI18nextTranslation } from 'react-i18next';

// --- DICTIONARIES ---
// The content of the JSON files is embedded directly to avoid module resolution errors.
const translationsEn = {
  "translation": {
    "appTitle": "Public Health AI Assistant",
    "welcomeTitle": "Hello! How can I assist you today?",
    "welcomeSubtitle": "I am an AI assistant from the Mukdahan Provincial Public Health Office.",
    "suggestedQuestions": [
      "What are the symptoms of dengue fever?",
      "Where is the nearest clinic to me?",
      "Tell me about the PM2.5 situation in Mukdahan.",
      "How do I apply for a health certificate?",
      "Can you analyze a health report for me?"
    ],
    "capabilityTitle": "My Capabilities",
    "capabilityChat": "Conversational AI",
    "capabilityChatDesc": "Ask me complex questions.",
    "capabilityImage": "Image Analysis",
    "capabilityImageDesc": "Analyze and discuss images.",
    "capabilityDoc": "Document Q&A",
    "capabilityDocDesc": "Ask questions about uploaded documents.",
    "capabilityVoice": "Voice Commands",
    "capabilityVoiceDesc": "Control the app with your voice.",
    "recommendSystem": "Recommend a healthy lunch menu for me",
    "recommendSystemPrompt": "Recommend a healthy lunch menu for me",
    "imageGenerationTriggers": [
      "generate image of",
      "create image of",
      "draw an image of",
      "make an image of"
    ],
    "imageEditingTriggers": [
      "edit image:",
      "edit this image:",
      "change image:",
      "change this image:",
      "add to image:",
      "remove from image:"
    ],
    "videoGenerationTriggers": [
      "generate video of",
      "create video of",
      "make a video of"
    ],
    "newChatTitle": "New Chat",
    "welcomeMessage": "Hello! I am your Public Health AI Assistant. How can I help you today?",
    "locationError": "Could not get your location. Please enable location services.",
    "toastNoActiveConversation": "No active conversation to export.",
    "toastExporting": "Exporting conversation...",
    "docConfirmTitle": "Start a new chat with this document?",
    "docConfirmMessage": "This will create a new conversation based on '{{fileName}}'.",
    "emergencyModalApiError": "Could not contact the emergency service API. Please check your connection or use the numbers below.",
    "emergencyModalLocationError": "Could not get your location for SOS. Please enable location services and try again.",
    "voiceCommandNewChat": "new chat",
    "voiceCommandReadLast": "read last message",
    "voiceCommandDarkMode": "dark mode",
    "voiceCommandLightMode": "light mode",
    "toastNewChat": "Started a new chat.",
    "toastReading": "Reading last message...",
    "toastNoMessage": "No message to read.",
    "toastDarkMode": "Switched to dark mode.",
    "toastLightMode": "Switched to light mode.",
    "tooltipSos": "Emergency (SOS)",
    "chat": "Chat",
    "live": "Live",
    "analyzer": "Analyzer",
    "hub": "Hub",
    "dashboard": "Dashboard",
    "tooltipPersona": "Set Persona / System Instruction",
    "tooltipExport": "Export Conversation",
    "tooltipTtsOn": "Text-to-Speech is ON",
    "tooltipTtsOff": "Text-to-Speech is OFF",
    "tooltipVoiceOn": "Voice Command is Listening",
    "tooltipVoiceOff": "Voice Command is OFF",
    "tooltipLanguage": "Switch Language",
    "tooltipTheme": "Toggle Theme",
    "copyCode": "Copy",
    "errorOccurred": "An error occurred.",
    "clickToRetry": "Click to retry",
    "thinking": "Thinking...",
    "generatingImage": "Generating image...",
    "generatingVideo": "Generating video...",
    "generatingFollowUps": "Generating follow-up questions...",
    "sources": "Sources",
    "followUpTitle": "Follow-up questions",
    "callingTool": "Calling tool: {{toolName}}",
    "usedTool": "Used tool: {{toolName}}",
    "showDetails": "Show details",
    "stopGeneration": "Stop Generation",
    "tooltipAttachOrAnalyze": "Attach files or analyze image/video",
    "speechListening": "Listening...",
    "inputPlaceholder": "Ask me anything, or type 'generate image of...' or 'create video of...'",
    "searchChatsPlaceholder": "Search conversations...",
    "noChatsFound": "No chats found.",
    "sidebarFeatureInfo": "This feature is available in '{{feature}}' mode. Switch modes to see other content.",
    "model": "Model",
    "modelFlashLiteLabel": "Flash Lite",
    "modelFlashLiteDesc": "Fastest model for simple tasks.",
    "modelFlashLabel": "Flash",
    "modelFlashDesc": "Balanced speed and capability.",
    "modelProLabel": "Pro",
    "modelProDesc": "Most capable for complex reasoning.",
    "tools": "Tools",
    "useKnowledgeBase": "Use Knowledge Base",
    "tooltipKnowledgeBase": "Allow the AI to use your uploaded documents to answer questions.",
    "searchWeb": "Search the web",
    "tooltipSearch": "Use Google Search for up-to-date information.",
    "useLocation": "Use current location",
    "tooltipLocation": "Provide location for relevant results (e.g., Maps).",
    "useClinic": "Clinic Finder",
    "tooltipClinic": "Allow the AI to find local health clinics.",
    "personaModalTitle": "Set Custom Instructions",
    "personaModalBody": "Provide custom instructions for the AI to follow in its responses. This will apply to the current conversation.",
    "personaModalPlaceholder": "e.g., 'You are a friendly assistant who explains medical terms in simple language.'",
    "cancel": "Cancel",
    "save": "Save",
    "confirm": "Confirm",
    "apiKeyModalTitle": "API Key Required",
    "apiKeyModalBody1": "Video generation requires a user-provided API key.",
    "apiKeyModalBody2": "Please select a key to proceed. For information on billing, see the",
    "billingDocumentation": "billing documentation",
    "selectApiKey": "Select API Key",
    "liveConnecting": "Connecting to live session...",
    "liveErrorConnection": "Connection error. Please try again.",
    "liveErrorMic": "Could not access microphone.",
    "liveListening": "Listening... (Talk to the AI)",
    "liveSessionEnded": "Session ended.",
    "you": "You",
    "bot": "Bot",
    "emergencyModalTitle": "Emergency Assistance",
    "emergencyModalLoading": "Finding nearest emergency room...",
    "foundLocationTitle": "NEAREST 24/7 EMERGENCY ROOM:",
    "getDirections": "Get Directions",
    "emergencyNumbersTitle": "Emergency Hotlines",
    "emergencyNumberNarenthorn": "Narenthorn Center (Medical Emergency)",
    "errorQuotaExceeded": "API quota exceeded. Please check your billing or try again later.",
    "errorImageSafety": "The request was blocked due to safety policies. Please adjust your prompt.",
    "voiceWakeWord": "assistant",
    "voiceSleepCommand": "go to sleep",
    "sharedFooterTitle": "Experience the Public Health AI Assistant",
    "sharedFooterBody": "This is a shared conversation. Create your own account to start new chats, upload documents, and more.",
    "sharedFooterButton": "Try the AI Assistant Now",
    "analyzerTitle": "Health Report Analyzer",
    "analyzerSubtitle": "Upload an image of your lab report to get a simplified explanation of your results.",
    "analyzerUploadPrompt": "Drop your health report here, or click to browse files.",
    "analyzerDisclaimerTitle": "Important Disclaimer",
    "analyzerDisclaimerBody": "This AI analysis is for informational purposes only and is NOT a substitute for professional medical advice, diagnosis, or treatment. Always consult with a qualified healthcare provider for any health concerns.",
    "analyzerButtonText": "Analyze Report",
    "analyzerLoading": "Analyzing report...",
    "analyzerError": "Could not analyze the report. The image might be unclear or the format may not be supported. Please try again with a clearer picture.",
    "analysisSummary": "Overall Summary",
    "analysisKeyFindings": "Key Findings",
    "analysisDetailedResults": "Detailed Breakdown",
    "statusHigh": "High",
    "statusLow": "Low",
    "statusNormal": "Normal",
    "statusAbnormal": "Abnormal",
    "hubTitle": "Health Hub",
    "hubSubtitle": "Latest health news and announcements for you, powered by AI.",
    "hubRefresh": "Refresh News",
    "hubLoading": "Finding latest health news...",
    "hubError": "Could not fetch health news. Please try again later.",
    "hubCategory_Alert": "Alert",
    "hubCategory_Campaign": "Campaign",
    "hubCategory_News": "News",
    "hubCategory_Tip": "Health Tip",
    "dashboardTitle": "Health Dashboard",
    "dashboardSubtitle": "Your personal health history. Track your analyzed reports over time.",
    "dashboardLoading": "Loading your health records...",
    "dashboardError": "Could not load health records. Please try again.",
    "dashboardEmptyTitle": "Your Dashboard is Empty",
    "dashboardEmptyBody": "After you analyze a health report in the 'Analyzer' tab, you can save it here to track your history.",
    "dashboardGoToAnalyzer": "Go to Analyzer",
    "dashboardSave": "Save to Dashboard",
    "dashboardSaving": "Saving...",
    "dashboardSavePrompt": "Enter a title for this report (e.g., Annual Checkup 2024):",
    "dashboardSaveSuccess": "Report saved to your dashboard!",
    "dashboardSaveError": "Failed to save the report.",
    "dashboardSaveDisabledTooltip": "Sign in to save reports to your dashboard.",
    "dashboardDeleteConfirm": "Are you sure you want to delete this health record? This action cannot be undone.",
    "dashboardDeleteSuccess": "Record deleted successfully.",
    "dashboardDeleteError": "Failed to delete the record."
  }
};

const translationsTh = {
  "translation": {
    "appTitle": "ผู้ช่วย AI สาธารณสุข",
    "welcomeTitle": "สวัสดี! มีอะไรให้ช่วยเหลือ?",
    "welcomeSubtitle": "ฉันคือผู้ช่วย AI จากสำนักงานสาธารณสุขจังหวัดมุกดาหาร",
    "suggestedQuestions": [
      "อาการของไข้เลือดออกมีอะไรบ้าง?",
      "คลินิกที่ใกล้ที่สุดอยู่ที่ไหน?",
      "สถานการณ์ฝุ่น PM2.5 ในมุกดาหารเป็นอย่างไร?",
      "ฉันจะขอใบรับรองแพทย์ได้อย่างไร?",
      "ช่วยวิเคราะห์ผลตรวจสุขภาพให้หน่อยได้ไหม?"
    ],
    "capabilityTitle": "ความสามารถของฉัน",
    "capabilityChat": "สนทนาอัจฉริยะ",
    "capabilityChatDesc": "ถามคำถามที่ซับซ้อนได้",
    "capabilityImage": "วิเคราะห์รูปภาพ",
    "capabilityImageDesc": "วิเคราะห์และพูดคุยเกี่ยวกับรูปภาพ",
    "capabilityDoc": "ถาม-ตอบ เอกสาร",
    "capabilityDocDesc": "ถามคำถามเกี่ยวกับเอกสารที่อัปโหลด",
    "capabilityVoice": "คำสั่งเสียง",
    "capabilityVoiceDesc": "ควบคุมแอปด้วยเสียงของคุณ",
    "recommendSystem": "แนะนำเมนูอาหารกลางวันเพื่อสุขภาพ",
    "recommendSystemPrompt": "แนะนำเมนูอาหารกลางวันเพื่อสุขภาพให้ฉันหน่อย",
    "imageGenerationTriggers": [
      "สร้างรูป",
      "สร้างภาพ",
      "วาดรูป"
    ],
    "imageEditingTriggers": [
      "แก้ไขรูป:",
      "แก้ไขภาพนี้:",
      "เปลี่ยนรูป:",
      "เปลี่ยนภาพนี้:",
      "เพิ่มในรูป:",
      "ลบจากรูป:"
    ],
    "videoGenerationTriggers": [
      "สร้างวิดีโอ",
      "ทำวิดีโอ"
    ],
    "newChatTitle": "แชทใหม่",
    "welcomeMessage": "สวัสดี! ฉันคือผู้ช่วย AI ด้านสาธารณสุข มีอะไรให้ช่วยเหลือ?",
    "locationError": "ไม่สามารถเข้าถึงตำแหน่งของคุณได้ กรุณาเปิดใช้งานบริการตำแหน่ง",
    "toastNoActiveConversation": "ไม่มีการสนทนาที่ใช้งานอยู่เพื่อส่งออก",
    "toastExporting": "กำลังส่งออกการสนทนา...",
    "docConfirmTitle": "เริ่มแชทใหม่ด้วยเอกสารนี้?",
    "docConfirmMessage": "การกระทำนี้จะสร้างการสนทนาใหม่จากเอกสาร '{{fileName}}'",
    "emergencyModalApiError": "ไม่สามารถติดต่อบริการฉุกเฉินได้ กรุณาตรวจสอบการเชื่อมต่อหรือใช้เบอร์โทรด้านล่าง",
    "emergencyModalLocationError": "ไม่สามารถระบุตำแหน่งของคุณสำหรับ SOS ได้ กรุณาเปิดบริการตำแหน่งแล้วลองอีกครั้ง",
    "voiceCommandNewChat": "แชทใหม่",
    "voiceCommandReadLast": "อ่านข้อความล่าสุด",
    "voiceCommandDarkMode": "โหมดมืด",
    "voiceCommandLightMode": "โหมดสว่าง",
    "toastNewChat": "เริ่มการสนทนาใหม่แล้ว",
    "toastReading": "กำลังอ่านข้อความล่าสุด...",
    "toastNoMessage": "ไม่มีข้อความให้อ่าน",
    "toastDarkMode": "เปลี่ยนเป็นโหมดมืด",
    "toastLightMode": "เปลี่ยนเป็นโหมดสว่าง",
    "tooltipSos": "ฉุกเฉิน (SOS)",
    "chat": "แชท",
    "live": "สนทนาสด",
    "analyzer": "วิเคราะห์ผล",
    "hub": "ศูนย์ข้อมูล",
    "dashboard": "แดชบอร์ด",
    "tooltipPersona": "ตั้งค่า Persona / คำสั่งระบบ",
    "tooltipExport": "ส่งออกการสนทนา",
    "tooltipTtsOn": "เปิดการอ่านออกเสียง",
    "tooltipTtsOff": "ปิดการอ่านออกเสียง",
    "tooltipVoiceOn": "คำสั่งเสียงกำลังทำงาน",
    "tooltipVoiceOff": "คำสั่งเสียงปิดอยู่",
    "tooltipLanguage": "เปลี่ยนภาษา",
    "tooltipTheme": "เปลี่ยนธีม",
    "copyCode": "คัดลอก",
    "errorOccurred": "เกิดข้อผิดพลาด",
    "clickToRetry": "คลิกเพื่อลองอีกครั้ง",
    "thinking": "กำลังคิด...",
    "generatingImage": "กำลังสร้างรูปภาพ...",
    "generatingVideo": "กำลังสร้างวิดีโอ...",
    "generatingFollowUps": "กำลังสร้างคำถามติดตาม...",
    "sources": "แหล่งข้อมูล",
    "followUpTitle": "คำถามที่อาจเกี่ยวข้อง",
    "callingTool": "กำลังเรียกใช้: {{toolName}}",
    "usedTool": "ใช้เครื่องมือ: {{toolName}}",
    "showDetails": "แสดงรายละเอียด",
    "stopGeneration": "หยุดการสร้าง",
    "tooltipAttachOrAnalyze": "แนบไฟล์หรือวิเคราะห์รูปภาพ/วิดีโอ",
    "speechListening": "กำลังฟัง...",
    "inputPlaceholder": "ถามอะไรก็ได้ หรือพิมพ์ 'สร้างรูป...' หรือ 'สร้างวิดีโอ...'",
    "searchChatsPlaceholder": "ค้นหาการสนทนา...",
    "noChatsFound": "ไม่พบการสนทนา",
    "sidebarFeatureInfo": "ประวัติการแชทจะแสดงในโหมดแชทเท่านั้น ขณะนี้คุณอยู่ในโหมด {{feature}}",
    "model": "โมเดล",
    "modelFlashLiteLabel": "แฟลช ไลท์",
    "modelFlashLiteDesc": "โมเดลที่เร็วที่สุดสำหรับงานง่ายๆ",
    "modelFlashLabel": "แฟลช",
    "modelFlashDesc": "ความเร็วและความสามารถที่สมดุล",
    "modelProLabel": "โปร",
    "modelProDesc": "ความสามารถสูงสุดสำหรับการให้เหตุผลที่ซับซ้อน",
    "tools": "เครื่องมือ",
    "useKnowledgeBase": "ใช้ฐานข้อมูลความรู้",
    "tooltipKnowledgeBase": "อนุญาตให้ AI ใช้เอกสารที่คุณอัปโหลดเพื่อตอบคำถาม",
    "searchWeb": "ค้นหาเว็บ",
    "tooltipSearch": "ใช้ Google Search เพื่อข้อมูลที่ทันสมัย",
    "useLocation": "ใช้ตำแหน่งปัจจุบัน",
    "tooltipLocation": "ให้ข้อมูลตำแหน่งเพื่อผลลัพธ์ที่เกี่ยวข้อง (เช่น แผนที่)",
    "useClinic": "ค้นหาคลินิก",
    "tooltipClinic": "อนุญาตให้ AI ค้นหาสถานพยาบาลในพื้นที่",
    "personaModalTitle": "ตั้งค่าคำสั่งที่กำหนดเอง",
    "personaModalBody": "ระบุคำสั่งเพื่อให้ AI ปฏิบัติตามในการตอบสนอง ซึ่งจะใช้กับการสนทนาปัจจุบัน",
    "personaModalPlaceholder": "เช่น 'คุณคือผู้ช่วยที่เป็นมิตรซึ่งอธิบายศัพท์ทางการแพทย์ด้วยภาษาง่ายๆ'",
    "cancel": "ยกเลิก",
    "save": "บันทึก",
    "confirm": "ยืนยัน",
    "apiKeyModalTitle": "ต้องการ API Key",
    "apiKeyModalBody1": "การสร้างวิดีโอต้องการ API Key ที่ผู้ใช้ระบุ",
    "apiKeyModalBody2": "กรุณาเลือก Key เพื่อดำเนินการต่อ สำหรับข้อมูลเกี่ยวกับการเรียกเก็บเงิน ดูที่",
    "billingDocumentation": "เอกสารการเรียกเก็บเงิน",
    "selectApiKey": "เลือก API Key",
    "liveConnecting": "กำลังเชื่อมต่อเซสชันสด...",
    "liveErrorConnection": "การเชื่อมต่อผิดพลาด กรุณาลองใหม่",
    "liveErrorMic": "ไม่สามารถเข้าถึงไมโครโฟนได้",
    "liveListening": "กำลังฟัง... (พูดคุยกับ AI)",
    "liveSessionEnded": "เซสชันสิ้นสุดแล้ว",
    "you": "คุณ",
    "bot": "บอท",
    "emergencyModalTitle": "ความช่วยเหลือฉุกเฉิน",
    "emergencyModalLoading": "กำลังค้นหาห้องฉุกเฉินที่ใกล้ที่สุด...",
    "foundLocationTitle": "ห้องฉุกเฉิน 24 ชั่วโมงที่ใกล้ที่สุด:",
    "getDirections": "ขอเส้นทาง",
    "emergencyNumbersTitle": "เบอร์โทรฉุกเฉิน",
    "emergencyNumberNarenthorn": "ศูนย์นเรนทร (การแพทย์ฉุกเฉิน)",
    "errorQuotaExceeded": "โควต้า API เกินกำหนด กรุณาตรวจสอบการเรียกเก็บเงินของคุณหรือลองอีกครั้งในภายหลัง",
    "errorImageSafety": "คำขอถูกบล็อกเนื่องจากนโยบายความปลอดภัย กรุณาปรับเปลี่ยนข้อความของคุณ",
    "voiceWakeWord": "ผู้ช่วย",
    "voiceSleepCommand": "ไปนอน",
    "sharedFooterTitle": "สัมผัสประสบการณ์ผู้ช่วย AI ด้านสาธารณสุข",
    "sharedFooterBody": "นี่คือการสนทนาที่ถูกแชร์ สร้างบัญชีของคุณเองเพื่อเริ่มแชทใหม่, อัปโหลดเอกสาร, และอื่นๆ",
    "sharedFooterButton": "ลองใช้ผู้ช่วย AI เลย",
    "analyzerTitle": "เครื่องมือวิเคราะห์ผลสุขภาพ",
    "analyzerSubtitle": "อัปโหลดรูปภาพผลตรวจจากห้องปฏิบัติการเพื่อรับคำอธิบายผลแบบง่ายๆ",
    "analyzerUploadPrompt": "วางไฟล์ผลตรวจของคุณที่นี่ หรือคลิกเพื่อเลือกไฟล์",
    "analyzerDisclaimerTitle": "ข้อจำกัดความรับผิดชอบที่สำคัญ",
    "analyzerDisclaimerBody": "การวิเคราะห์โดย AI นี้มีวัตถุประสงค์เพื่อให้ข้อมูลเท่านั้น และไม่สามารถใช้แทนคำแนะนำ การวินิจฉัย หรือการรักษาทางการแพทย์จากผู้เชี่ยวชาญได้ โปรดปรึกษาผู้ให้บริการด้านสุขภาพที่มีคุณสมบัติเสมอสำหรับข้อกังวลด้านสุขภาพใดๆ",
    "analyzerButtonText": "วิเคราะห์ผล",
    "analyzerLoading": "กำลังวิเคราะห์ผล...",
    "analyzerError": "ไม่สามารถวิเคราะห์ผลตรวจได้ รูปภาพอาจไม่ชัดเจนหรือรูปแบบไม่รองรับ กรุณาลองอีกครั้งด้วยรูปที่ชัดเจนกว่า",
    "analysisSummary": "สรุปภาพรวม",
    "analysisKeyFindings": "ผลที่น่าสนใจ",
    "analysisDetailedResults": "รายละเอียดผลการตรวจ",
    "statusHigh": "สูง",
    "statusLow": "ต่ำ",
    "statusNormal": "ปกติ",
    "statusAbnormal": "ผิดปกติ",
    "hubTitle": "ศูนย์ข้อมูลข่าวสาร",
    "hubSubtitle": "ข่าวสารและประกาศด้านสุขภาพล่าสุดสำหรับคุณ โดย AI",
    "hubRefresh": "รีเฟรชข่าว",
    "hubLoading": "กำลังค้นหาข่าวสุขภาพล่าสุด...",
    "hubError": "ไม่สามารถดึงข้อมูลข่าวสารได้ กรุณาลองอีกครั้งในภายหลัง",
    "hubCategory_Alert": "แจ้งเตือน",
    "hubCategory_Campaign": "รณรงค์",
    "hubCategory_News": "ข่าวสาร",
    "hubCategory_Tip": "เคล็ดลับสุขภาพ",
    "dashboardTitle": "แดชบอร์ดสุขภาพ",
    "dashboardSubtitle": "ประวัติสุขภาพส่วนตัวของคุณ ติดตามผลการวิเคราะห์ย้อนหลังได้ที่นี่",
    "dashboardLoading": "กำลังโหลดข้อมูลสุขภาพของคุณ...",
    "dashboardError": "ไม่สามารถโหลดข้อมูลสุขภาพได้ กรุณาลองอีกครั้ง",
    "dashboardEmptyTitle": "แดชบอร์ดของคุณว่างเปล่า",
    "dashboardEmptyBody": "หลังจากวิเคราะห์ผลตรวจในแท็บ 'วิเคราะห์ผล' คุณสามารถบันทึกมาไว้ที่นี่เพื่อติดตามประวัติได้",
    "dashboardGoToAnalyzer": "ไปที่หน้าวิเคราะห์ผล",
    "dashboardSave": "บันทึกลงแดชบอร์ด",
    "dashboardSaving": "กำลังบันทึก...",
    "dashboardSavePrompt": "ตั้งชื่อสำหรับผลตรวจนี้ (เช่น 'ตรวจสุขภาพประจำปี 2567'):",
    "dashboardSaveSuccess": "บันทึกผลตรวจลงแดชบอร์ดแล้ว!",
    "dashboardSaveError": "ไม่สามารถบันทึกผลตรวจได้",
    "dashboardSaveDisabledTooltip": "กรุณาลงชื่อเข้าใช้เพื่อบันทึกผลตรวจลงแดชบอร์ด",
    "dashboardDeleteConfirm": "คุณแน่ใจหรือไม่ว่าต้องการลบบันทึกสุขภาพนี้? การกระทำนี้ไม่สามารถย้อนกลับได้",
    "dashboardDeleteSuccess": "ลบบันทึกเรียบร้อยแล้ว",
    "dashboardDeleteError": "ไม่สามารถลบบันทึกได้"
  }
};

i18next
  .use(initReactI18next)
  .init({
    resources: {
      en: translationsEn,
      th: translationsTh,
    },
    lng: 'th', // default language
    fallbackLng: 'en',
    interpolation: {
      escapeValue: false, // react already safes from xss
    },
  });

type Language = 'en' | 'th';

interface LanguageContextType {
  language: Language;
  setLanguage: (language: Language) => void;
  t: (key: string, options?: any) => any;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const { t, i18n } = useI18nextTranslation();
  const [language, setLanguageState] = useState<Language>((i18n.language as Language) || 'th');

  const setLanguage = useCallback((lang: Language) => {
    i18n.changeLanguage(lang);
    setLanguageState(lang);
  }, [i18n]);

  const value = { language, setLanguage, t };

  return React.createElement(LanguageContext.Provider, { value: value }, children);
};

export const useTranslation = (): LanguageContextType => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
};
